export const DEFAULT_TERRAIN_GENERATION_CONTROLS = {
    spacing: 16,
    provinceCount: 8,
    provinceSizeVariance: 0.4,
    provincePassageElevation: 6,
    provinceRiverPenalty: 0.6,
    provinceSmallIslandMultiplier: 0.35,
    provinceArchipelagoMultiplier: 0.2,
    provinceIslandSingleMultiplier: 1.6,
    provinceArchipelagoRadiusMultiplier: 3,
    seed: 1337,
    waterLevel: -10,
    waterRoughness: 60,
    waterNoiseScale: 2,
    waterNoiseStrength: 0,
    waterNoiseOctaves: 1,
    waterWarpScale: 2,
    waterWarpStrength: 0.7,
    riverDensity: 1,
    riverBranchChance: 0.25,
    riverClimbChance: 0.35,
    landRelief: 0.95,
    ridgeStrength: 0.85,
    ridgeCount: 9,
    plateauStrength: 0.8,
    ridgeDistribution: 0.8,
    ridgeSeparation: 0.95,
    ridgeContinuity: 0.25,
    ridgeContinuityThreshold: 0,
    oceanPeakClamp: 0.05,
    ridgeOceanClamp: 0.5,
    ridgeWidth: 1,
};
const DEFAULT_LEGACY_RENDER_OVERRIDES = {
    showPolygonGraph: false,
    showDualGraph: false,
    showCornerNodes: false,
    showCenterNodes: false,
    showInsertedPoints: false,
    provinceBorderWidth: 6.5,
    showLandBorders: true,
    showShoreBorders: true,
    intermediateSeed: 1337,
    intermediateMaxIterations: 8,
    intermediateThreshold: 5,
    intermediateRelMagnitude: 0,
    intermediateAbsMagnitude: 2,
};
function clamp(value, min, max) {
    return Math.max(min, Math.min(max, value));
}
function readNumber(value, fallback) {
    return typeof value === 'number' && Number.isFinite(value) ? value : fallback;
}
export function normalizeTerrainGenerationControls(controlsRaw) {
    const controls = controlsRaw ?? {};
    const defaults = DEFAULT_TERRAIN_GENERATION_CONTROLS;
    return {
        spacing: clamp(Math.round(readNumber(controls.spacing, defaults.spacing)), 16, 128),
        provinceCount: clamp(Math.round(readNumber(controls.provinceCount, defaults.provinceCount)), 1, 32),
        provinceSizeVariance: clamp(readNumber(controls.provinceSizeVariance, defaults.provinceSizeVariance), 0, 0.75),
        provincePassageElevation: clamp(Math.round(readNumber(controls.provincePassageElevation, defaults.provincePassageElevation)), 0, 32),
        provinceRiverPenalty: clamp(readNumber(controls.provinceRiverPenalty, defaults.provinceRiverPenalty), 0, 2),
        provinceSmallIslandMultiplier: clamp(readNumber(controls.provinceSmallIslandMultiplier, defaults.provinceSmallIslandMultiplier), 0, 1),
        provinceArchipelagoMultiplier: clamp(readNumber(controls.provinceArchipelagoMultiplier, defaults.provinceArchipelagoMultiplier), 0, 1),
        provinceIslandSingleMultiplier: clamp(readNumber(controls.provinceIslandSingleMultiplier, defaults.provinceIslandSingleMultiplier), 1, 3),
        provinceArchipelagoRadiusMultiplier: clamp(readNumber(controls.provinceArchipelagoRadiusMultiplier, defaults.provinceArchipelagoRadiusMultiplier), 1, 6),
        seed: clamp(Math.floor(readNumber(controls.seed, defaults.seed)), 0, 0xffffffff),
        waterLevel: clamp(Math.round(readNumber(controls.waterLevel, defaults.waterLevel)), -40, 40),
        waterRoughness: clamp(Math.round(readNumber(controls.waterRoughness, defaults.waterRoughness)), 0, 100),
        waterNoiseScale: clamp(Math.round(readNumber(controls.waterNoiseScale, defaults.waterNoiseScale)), 2, 60),
        waterNoiseStrength: clamp(readNumber(controls.waterNoiseStrength, defaults.waterNoiseStrength), 0, 1),
        waterNoiseOctaves: clamp(Math.round(readNumber(controls.waterNoiseOctaves, defaults.waterNoiseOctaves)), 1, 6),
        waterWarpScale: clamp(Math.round(readNumber(controls.waterWarpScale, defaults.waterWarpScale)), 2, 40),
        waterWarpStrength: clamp(readNumber(controls.waterWarpStrength, defaults.waterWarpStrength), 0, 0.8),
        riverDensity: clamp(readNumber(controls.riverDensity, defaults.riverDensity), 0, 2),
        riverBranchChance: clamp(readNumber(controls.riverBranchChance, defaults.riverBranchChance), 0, 1),
        riverClimbChance: clamp(readNumber(controls.riverClimbChance, defaults.riverClimbChance), 0, 1),
        landRelief: clamp(readNumber(controls.landRelief, defaults.landRelief), 0, 1),
        ridgeStrength: clamp(readNumber(controls.ridgeStrength, defaults.ridgeStrength), 0, 1),
        ridgeCount: clamp(Math.round(readNumber(controls.ridgeCount, defaults.ridgeCount)), 1, 10),
        plateauStrength: clamp(readNumber(controls.plateauStrength, defaults.plateauStrength), 0, 1),
        ridgeDistribution: clamp(readNumber(controls.ridgeDistribution, defaults.ridgeDistribution), 0, 1),
        ridgeSeparation: clamp(readNumber(controls.ridgeSeparation, defaults.ridgeSeparation), 0, 1),
        ridgeContinuity: clamp(readNumber(controls.ridgeContinuity, defaults.ridgeContinuity), 0, 1),
        ridgeContinuityThreshold: clamp(readNumber(controls.ridgeContinuityThreshold, defaults.ridgeContinuityThreshold), 0, 1),
        oceanPeakClamp: clamp(readNumber(controls.oceanPeakClamp, defaults.oceanPeakClamp), 0, 1),
        ridgeOceanClamp: clamp(readNumber(controls.ridgeOceanClamp, defaults.ridgeOceanClamp), 0, 1),
        ridgeWidth: clamp(readNumber(controls.ridgeWidth, defaults.ridgeWidth), 0, 1),
    };
}
export function toLegacyTerrainControls(generationControls, renderOverrides) {
    const render = {
        ...DEFAULT_LEGACY_RENDER_OVERRIDES,
        ...(renderOverrides ?? {}),
    };
    return {
        spacing: generationControls.spacing,
        showPolygonGraph: render.showPolygonGraph,
        showDualGraph: render.showDualGraph,
        showCornerNodes: render.showCornerNodes,
        showCenterNodes: render.showCenterNodes,
        showInsertedPoints: render.showInsertedPoints,
        provinceCount: generationControls.provinceCount,
        provinceBorderWidth: render.provinceBorderWidth,
        provinceSizeVariance: generationControls.provinceSizeVariance,
        provincePassageElevation: generationControls.provincePassageElevation,
        provinceRiverPenalty: generationControls.provinceRiverPenalty,
        provinceSmallIslandMultiplier: generationControls.provinceSmallIslandMultiplier,
        provinceArchipelagoMultiplier: generationControls.provinceArchipelagoMultiplier,
        provinceIslandSingleMultiplier: generationControls.provinceIslandSingleMultiplier,
        provinceArchipelagoRadiusMultiplier: generationControls.provinceArchipelagoRadiusMultiplier,
        showLandBorders: render.showLandBorders,
        showShoreBorders: render.showShoreBorders,
        seed: generationControls.seed,
        intermediateSeed: render.intermediateSeed,
        intermediateMaxIterations: render.intermediateMaxIterations,
        intermediateThreshold: render.intermediateThreshold,
        intermediateRelMagnitude: render.intermediateRelMagnitude,
        intermediateAbsMagnitude: render.intermediateAbsMagnitude,
        waterLevel: generationControls.waterLevel,
        waterRoughness: generationControls.waterRoughness,
        waterNoiseScale: generationControls.waterNoiseScale,
        waterNoiseStrength: generationControls.waterNoiseStrength,
        waterNoiseOctaves: generationControls.waterNoiseOctaves,
        waterWarpScale: generationControls.waterWarpScale,
        waterWarpStrength: generationControls.waterWarpStrength,
        riverDensity: generationControls.riverDensity,
        riverBranchChance: generationControls.riverBranchChance,
        riverClimbChance: generationControls.riverClimbChance,
        landRelief: generationControls.landRelief,
        ridgeStrength: generationControls.ridgeStrength,
        ridgeCount: generationControls.ridgeCount,
        plateauStrength: generationControls.plateauStrength,
        ridgeDistribution: generationControls.ridgeDistribution,
        ridgeSeparation: generationControls.ridgeSeparation,
        ridgeContinuity: generationControls.ridgeContinuity,
        ridgeContinuityThreshold: generationControls.ridgeContinuityThreshold,
        oceanPeakClamp: generationControls.oceanPeakClamp,
        ridgeWidth: generationControls.ridgeWidth,
        ridgeOceanClamp: generationControls.ridgeOceanClamp,
    };
}
export function fingerprintTerrainGenerationControls(controls) {
    return JSON.stringify([
        controls.spacing,
        controls.provinceCount,
        controls.provinceSizeVariance,
        controls.provincePassageElevation,
        controls.provinceRiverPenalty,
        controls.provinceSmallIslandMultiplier,
        controls.provinceArchipelagoMultiplier,
        controls.provinceIslandSingleMultiplier,
        controls.provinceArchipelagoRadiusMultiplier,
        controls.seed,
        controls.waterLevel,
        controls.waterRoughness,
        controls.waterNoiseScale,
        controls.waterNoiseStrength,
        controls.waterNoiseOctaves,
        controls.waterWarpScale,
        controls.waterWarpStrength,
        controls.riverDensity,
        controls.riverBranchChance,
        controls.riverClimbChance,
        controls.landRelief,
        controls.ridgeStrength,
        controls.ridgeCount,
        controls.plateauStrength,
        controls.ridgeDistribution,
        controls.ridgeSeparation,
        controls.ridgeContinuity,
        controls.ridgeContinuityThreshold,
        controls.oceanPeakClamp,
        controls.ridgeOceanClamp,
        controls.ridgeWidth,
    ]);
}
